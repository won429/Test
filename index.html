<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Enjoy Vote - Design Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Pretendard', sans-serif;
            background-color: #202020;
            margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }

        #mobile-frame {
            width: 100%; max-width: 430px; height: 100%; max-height: 100dvh;
            background: #F2F4F6; position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); display: flex; flex-direction: column;
            z-index: 10;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        .toss-card {
            background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 24px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.04); 
            transition: transform 0.1s; cursor: pointer;
        }
        .toss-card:active { transform: scale(0.97); }

        .screen {
            position: absolute; inset: 0; background: #F2F4F6;
            display: flex; flex-direction: column; overflow: hidden;
            opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 10;
        }
        .screen.active { opacity: 1; pointer-events: auto; z-index: 20; }

        .full-modal {
            position: absolute; inset: 0; background: #F2F4F6; z-index: 100;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .full-modal.open { transform: translateY(0); }

        .rank-1-card {
            background: linear-gradient(135deg, #FFF 0%, #FDF4FF 100%);
            border: 2px solid #D8B4FE; box-shadow: 0 8px 32px rgba(168, 85, 247, 0.15);
        }
        .bar-gradient { background: linear-gradient(90deg, #C084FC 0%, #A855F7 100%); }
        .number-counting { font-variant-numeric: tabular-nums; }
        
        #confetti-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 150;
        }

        /* ğŸ“¸ [í•µì‹¬] ì¸ì¦ì„œ ìº¡ì²˜ìš© ì»¨í…Œì´ë„ˆ (í™”ë©´ ë®ëŠ” ì˜¤ë²„ë ˆì´) */
        #cert-overlay-stage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #F2F4F6; /* ì•± ë°°ê²½ìƒ‰ê³¼ ë™ì¼í•˜ê²Œ */
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #cert-overlay-stage.active { opacity: 1; pointer-events: auto; }

        /* ğŸ“¸ í† ìŠ¤ ìŠ¤íƒ€ì¼ ì¸ì¦ì„œ ë””ìì¸ */
        .toss-cert-card {
            width: 320px;
            background: white;
            border-radius: 32px;
            padding: 40px 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.08);
            display: flex; flex-direction: column; align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        /* ëª¨ë‹¬ ê³µí†µ */
        .custom-modal {
            position: absolute; inset: 0; background: rgba(0,0,0,0.6);
            z-index: 200; display: none; flex-direction: column; 
            align-items: center; justify-content: center; backdrop-filter: blur(4px);
        }
        .custom-modal.show { display: flex; }
        .scale-up { animation: scaleUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes scaleUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .pt-safe { padding-top: max(12px, env(safe-area-inset-top)); }
    </style>
</head>
<body>

    <!-- ğŸ“¸ ì¸ì¦ì„œ ìƒì„± ìŠ¤í…Œì´ì§€ (í™”ë©´ì— ì‹¤ì œë¡œ ê·¸ë ¤ì§ -> ìº¡ì²˜ í›„ ìˆ¨ê¹€) -->
    <div id="cert-overlay-stage">
        <div class="mb-6 text-center">
            <div class="w-10 h-10 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-3"></div>
            <p class="text-gray-500 font-bold">ì¸ì¦ì„œë¥¼ ë§Œë“¤ê³  ìˆì–´ìš”...</p>
        </div>

        <!-- ì‹¤ì œ ì¸ì¦ì„œ (Toss Style) -->
        <div id="cert-target" class="toss-cert-card">
            <!-- ìƒë‹¨ ë¡œê³ /ì•„ì´ì½˜ -->
            <div class="w-16 h-16 rounded-[24px] bg-blue-50 flex items-center justify-center text-3xl mb-6 shadow-sm text-blue-500">
                <i class="fa-solid fa-check"></i>
            </div>

            <!-- ë©”ì¸ í…ìŠ¤íŠ¸ -->
            <h1 class="text-2xl font-bold text-[#191F28] mb-2">íˆ¬í‘œë¥¼ ì™„ë£Œí–ˆì–´ìš”</h1>
            <p class="text-[#6B7684] text-sm mb-8">ì†Œì¤‘í•œ í•œ í‘œê°€ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

            <!-- íˆ¬í‘œ ì •ë³´ ë°•ìŠ¤ -->
            <div class="w-full bg-[#F9FAFB] rounded-[24px] p-5 mb-8">
                <p class="text-xs text-[#8B95A1] font-bold mb-1">íˆ¬í‘œ í•­ëª©</p>
                <h2 id="cert-song-name" class="text-xl font-bold text-[#3182F6] break-keep leading-tight">ë…¸ë˜ ì œëª©</h2>
                <div class="w-full h-[1px] bg-gray-200 my-4"></div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-[#8B95A1]">ì°¸ì—¬ì</span>
                    <span id="cert-user-name" class="font-bold text-[#333D4B]">í™ê¸¸ë™</span>
                </div>
                <div class="flex justify-between items-center text-sm mt-2">
                    <span class="text-[#8B95A1]">ì¼ì‹œ</span>
                    <span id="cert-date" class="font-medium text-[#333D4B] tabular-nums">2024.02.10 14:00</span>
                </div>
            </div>

            <!-- í•˜ë‹¨ ë¡œê³  -->
            <div class="flex items-center gap-2 opacity-40">
                <span class="font-bold text-xs tracking-widest text-[#191F28]">ENJOY VOTE</span>
            </div>
        </div>
    </div>

    <!-- ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="mobile-frame">
        <canvas id="confetti-canvas"></canvas>
        
        <!-- 1. ì´ë¦„ ì…ë ¥ ëª¨ë‹¬ -->
        <div id="name-input-modal" class="custom-modal">
            <div class="bg-white w-[85%] max-w-[320px] rounded-[24px] p-6 text-center scale-up shadow-xl relative">
                <button onclick="document.getElementById('name-input-modal').classList.remove('show')" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500"><i class="fa-solid fa-xmark text-xl"></i></button>
                <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-500 text-xl"><i class="fa-solid fa-pen"></i></div>
                <h3 class="text-lg font-bold text-[#191F28] mb-1">ì´ë¦„ ì…ë ¥</h3>
                <p class="text-xs text-[#6B7684] mb-5">ì¸ì¦ì„œì— í‘œì‹œë  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <input type="text" id="voter-name-input" placeholder="ì˜ˆ: ê¹€ì—”ì¡°" class="w-full bg-[#F2F4F6] border-none rounded-xl px-4 py-3.5 text-center text-base font-bold text-[#191F28] mb-3 focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all" autocomplete="off">
                <button onclick="window.confirmNameAndGenerate()" class="w-full bg-[#3182F6] text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-100 active:scale-95 transition-transform">ì¸ì¦ì„œ ë§Œë“¤ê¸°</button>
            </div>
        </div>

        <!-- 2. ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° íŒì—… -->
        <div id="img-preview-modal" class="custom-modal">
            <div class="w-full h-full flex flex-col items-center justify-center p-6 relative">
                <button onclick="closePreview()" class="absolute top-6 right-6 w-10 h-10 bg-white/20 backdrop-blur rounded-full flex items-center justify-center text-white text-xl z-50 hover:bg-white/30">âœ•</button>
                
                <div class="text-center mb-6 scale-up">
                    <h3 class="text-white font-bold text-xl mb-1">ì¸ì¦ì„œ ë°œê¸‰ ì™„ë£Œ âœ¨</h3>
                    <p class="text-white/80 text-sm">ì´ë¯¸ì§€ë¥¼ <span class="text-yellow-300 font-bold border-b border-yellow-300 pb-0.5">ê¸¸ê²Œ ê¾¹ ëˆŒëŸ¬ì„œ</span> ì €ì¥í•˜ì„¸ìš”!</p>
                </div>
                
                <img id="generated-cert-img" src="" class="w-auto max-h-[60vh] rounded-[24px] shadow-2xl mb-8 scale-up border-[6px] border-white/10">
                
                <button onclick="closePreview()" class="bg-white/20 border border-white/30 text-white px-10 py-3.5 rounded-full text-sm font-bold backdrop-blur-md active:bg-white/30 transition-colors">
                    ë‹«ê¸°
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ í™”ë©´ -->
        <div id="screen-home" class="screen active">
            <header class="flex-none px-5 pt-safe pb-2 flex items-center bg-white/50 backdrop-blur-md sticky top-0 z-20 h-14">
                <h1 class="text-xl font-bold text-[#191F28]">ì—”ì¡°ì´ íˆ¬í‘œ</h1>
            </header>

            <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pb-20 pt-2">
                <!-- ë°°ë„ˆ -->
                <div class="fade-in-up delay-100 mb-8 w-full h-72 rounded-[28px] relative overflow-hidden cursor-pointer group shadow-lg shadow-purple-200" onclick="window.openPollDetail(0)">
                    <div class="absolute inset-0 bg-gradient-to-br from-[#F3E8FF] via-[#E9D5FF] to-[#D8B4FE]"></div>
                    <div class="absolute -right-4 -top-4 w-40 h-40 bg-white/40 rounded-full blur-2xl"></div>
                    <div class="absolute -left-4 bottom-4 w-32 h-32 bg-purple-300/30 rounded-full blur-2xl"></div>
                    <img src="program_logo.png" alt="Logo" class="absolute right-4 bottom-4 w-36 h-36 object-contain drop-shadow-xl rotate-[-5deg] filter brightness-105" onerror="this.style.display='none'; document.getElementById('fb-icon').style.display='block'">
                    <div id="fb-icon" class="hidden absolute right-6 bottom-6 text-[80px] drop-shadow-lg rotate-[-10deg] filter brightness-105">ğŸ¤</div>
                    <div class="relative z-10 h-full p-6 flex flex-col justify-between">
                        <div>
                            <span class="inline-flex items-center gap-1 bg-white/70 text-purple-700 text-[10px] font-bold px-2.5 py-1 rounded-full mb-2 backdrop-blur-sm shadow-sm"><span class="w-1.5 h-1.5 rounded-full bg-purple-600 animate-pulse"></span> VOTE NOW</span>
                            <h2 class="text-[26px] font-extrabold text-[#191F28] leading-[1.15]">ì„¤ë‚ íŠ¹ì„ <br>ì—”ì¡°ì´ ì¸ê¸°ê°€ìš”2<br><span class="text-purple-600">ì‚¬ì „íˆ¬í‘œ</span></h2>
                            <p class="text-gray-600 font-medium mt-3 text-xs opacity-80">ğŸµ ë„ˆì˜ ëª¨ë“  ìˆœê°„<br>ğŸµ í°ìˆ˜ì—¼ ê³ ë˜</p>
                        </div>
                        <div class="flex items-center gap-2"><span class="text-xs font-bold text-white bg-purple-500 px-5 py-2.5 rounded-full shadow-md">ì§€ê¸ˆ íˆ¬í‘œí•˜ê¸° â†’</span></div>
                    </div>
                </div>

                <!-- ê²°ê³¼ & ë¹„ìœ¨ -->
                <div class="fade-in-up delay-200">
                    <h3 class="text-lg font-bold text-[#191F28] mb-3 px-1">íˆ¬í‘œ ê²°ê³¼</h3>
                    <div id="result-list" class="space-y-3"></div>
                </div>
                <div class="fade-in-up delay-300 mt-8 mb-6">
                    <h3 class="text-lg font-bold text-[#191F28] mb-3 px-1">íˆ¬í‘œ ë°˜ì˜ ë¹„ìœ¨</h3>
                    <div class="bg-white/70 backdrop-blur-sm rounded-[24px] p-5 border border-white/60 shadow-sm space-y-5">
                        <div><div class="flex justify-between items-end mb-2"><span class="text-xs font-bold text-gray-500">ì•„í‹°ìŠ¤íŠ¸ ì‚¬ì „íˆ¬í‘œ</span><span class="text-sm font-bold text-blue-500">15%</span></div><div class="w-full bg-gray-100/80 rounded-full h-2.5 overflow-hidden"><div class="bg-blue-400 h-full rounded-full" style="width: 15%"></div></div></div>
                        <div><div class="flex justify-between items-end mb-2"><span class="text-xs font-bold text-gray-500">ë…¸ë˜ì œëª© ì‚¬ì „íˆ¬í‘œ</span><span class="text-sm font-bold text-green-500">15%</span></div><div class="w-full bg-gray-100/80 rounded-full h-2.5 overflow-hidden"><div class="bg-green-400 h-full rounded-full" style="width: 15%"></div></div></div>
                        <div><div class="flex justify-between items-end mb-2"><span class="text-xs font-bold text-gray-500">AI ì‹¤ë ¥í‰ê°€</span><span class="text-sm font-bold text-pink-500">30%</span></div><div class="w-full bg-gray-100/80 rounded-full h-2.5 overflow-hidden"><div class="bg-pink-400 h-full rounded-full" style="width: 30%"></div></div></div>
                        <div><div class="flex justify-between items-end mb-2"><span class="text-xs font-bold text-gray-500">ë³¸íˆ¬í‘œ (ìƒë°©ì†¡)</span><span class="text-sm font-bold text-purple-600">40%</span></div><div class="w-full bg-gray-100/80 rounded-full h-2.5 overflow-hidden"><div class="bg-purple-600 h-full rounded-full" style="width: 40%"></div></div></div>
                    </div>
                </div>
                <div class="h-8"></div>
            </div>
        </div>

        <!-- ëª¨ë‹¬ (ìƒì„¸) -->
        <div id="modal-detail" class="full-modal">
            <header class="flex-none px-5 pt-safe pb-2 flex justify-between items-center bg-white/80 backdrop-blur-md border-b border-gray-100 z-20 h-14">
                <button onclick="window.closeModal()" class="w-8 h-8 rounded-full hover:bg-black/5 flex items-center justify-center"><i class="fa-solid fa-chevron-left text-lg text-[#191F28]"></i></button>
                <span class="text-sm font-bold text-[#191F28]">íˆ¬í‘œ ìƒì„¸</span>
                <div class="w-8"></div>
            </header>
            <div class="flex-1 overflow-y-auto scrollbar-hide px-5 pt-6 pb-10">
                <div class="text-center mb-8">
                    <span id="poll-badge" class="inline-block px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-bold rounded mb-2">ìƒíƒœ</span>
                    <h2 id="detail-title" class="text-2xl font-bold text-[#191F28] mb-1.5 leading-tight break-keep">ì œëª©</h2>
                    <p id="detail-info" class="text-xs text-gray-500 font-medium">ì •ë³´</p>
                </div>
                <div id="detail-options" class="space-y-3 pb-8"></div>
                <div class="mt-4 pb-12">
                    <button id="btn-submit" onclick="window.submitVote()" class="w-full bg-purple-500 text-white font-bold text-lg py-4 rounded-[24px] shadow-lg active:scale-95 transition-transform disabled:bg-gray-300">íˆ¬í‘œí•˜ê¸°</button>
                    <div id="result-buttons" class="hidden space-y-3 mt-3">
                        <button onclick="window.voteAgain()" class="w-full bg-white border border-purple-200 text-purple-600 font-bold text-lg py-4 rounded-[24px] shadow-sm active:scale-95 transition-transform">í•œ ë²ˆ ë” íˆ¬í‘œí•˜ê¸° â†º</button>
                        <button onclick="window.startCertProcess()" class="w-full bg-gray-100 text-gray-600 font-bold text-base py-3.5 rounded-[24px] active:scale-95 transition-transform flex items-center justify-center gap-2">
                            <i class="fa-solid fa-image"></i> íˆ¬í‘œ ì¸ì¦ì„œ ë§Œë“¤ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•˜ë‹¨ë°” -->
        <nav id="bottom-nav">
            <div class="flex items-center bg-white/90 backdrop-blur-xl shadow-[0_4px_20px_rgb(0,0,0,0.1)] border border-white/50 rounded-full p-1 gap-1">
                <div id="nav-bg" class="absolute top-1 bottom-1 bg-gray-100 rounded-full z-0 transition-all duration-300 ease-out" style="left: 4px; width: 56px;"></div>
                <button onclick="window.switchTab(0)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-0"><i class="fa-solid fa-house text-lg text-[#191F28]"></i><span class="text-[9px] font-bold text-[#191F28]">í™ˆ</span></button>
                <button onclick="window.switchTab(1)" class="relative z-10 w-14 py-1.5 flex flex-col items-center gap-0.5 group" id="btn-tab-1"><i class="fa-solid fa-user text-lg text-[#B0B8C1]"></i><span class="text-[9px] font-medium text-[#B0B8C1]">ë‚´ ì •ë³´</span></button>
            </div>
        </nav>
    </div>

    <script>
        window.polls = [
            { id: 0, type: 'active', title: "ì„¤ë‚ íŠ¹ì„  ì—”ì¡°ì´ ì¸ê¸°ê°€ìš”2 ì‚¬ì „íˆ¬í‘œ ğŸ¤", author: "ì—”ì¡°ì´ ì œì‘ì§„", total: 0, options: [{ text: "ë„ˆì˜ ëª¨ë“  ìˆœê°„", count: 0 }, { text: "í°ìˆ˜ì—¼ ê³ ë˜", count: 0 }], myPick: null, hasVoted: false },
            { id: 1, type: 'result', title: "ì¸ê¸°ê°€ìš”2 ì•„í‹°ìŠ¤íŠ¸ ì‚¬ì „íˆ¬í‘œ ğŸ‘¨â€ğŸ¤", author: "ì—”ì¡°ì´ ì œì‘ì§„", total: 5, options: [{ text: "ì „ì‹œê¸°", count: 3 }, { text: "í™ë°•ì‚¬", count: 2 }], icon: "ğŸ‘¨â€ğŸ¤", color: "bg-blue-50 text-blue-500", myPick: null, hasVoted: true }
        ];
        window.currentPollId = null;
        window.selectedOptionIdx = null;

        // [í•µì‹¬] ìˆ˜ì •ëœ ì¸ì¦ì„œ ë¡œì§ (ì•ˆì •ì„± ìµœìš°ì„ )
        window.startCertProcess = function() {
            document.getElementById('voter-name-input').value = '';
            document.getElementById('name-input-modal').classList.add('show');
            setTimeout(() => document.getElementById('voter-name-input').focus(), 100);
        };

        window.confirmNameAndGenerate = function() {
            const name = document.getElementById('voter-name-input').value.trim();
            if(!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
            document.getElementById('name-input-modal').classList.remove('show');
            
            // ë°ì´í„° ì„¤ì •
            const p = window.polls.find(item => item.id === window.currentPollId);
            const myPickText = p.myPick !== null ? p.options[p.myPick].text : "íˆ¬í‘œ ì™„ë£Œ";
            const now = new Date();
            const dateStr = now.toLocaleDateString('ko-KR', {year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'});

            document.getElementById('cert-user-name').innerText = name;
            document.getElementById('cert-song-name').innerText = myPickText;
            document.getElementById('cert-date').innerText = dateStr;

            // ìŠ¤í…Œì´ì§€ í™œì„±í™” (ë¡œë”© í‘œì‹œ)
            const stage = document.getElementById('cert-overlay-stage');
            stage.classList.add('active');

            // ë Œë”ë§ ì•ˆì •í™”ë¥¼ ìœ„í•´ 0.8ì´ˆ ëŒ€ê¸° í›„ ìº¡ì²˜
            setTimeout(() => {
                const certEl = document.getElementById('cert-target');
                html2canvas(certEl, { 
                    scale: 2, 
                    backgroundColor: null, 
                    useCORS: true,
                    logging: false 
                }).then(canvas => {
                    const imgData = canvas.toDataURL("image/png");
                    document.getElementById('generated-cert-img').src = imgData;
                    
                    // ìŠ¤í…Œì´ì§€ ìˆ¨ê¹€ ë° ê²°ê³¼ì°½ í‘œì‹œ
                    stage.classList.remove('active');
                    document.getElementById('img-preview-modal').classList.add('show');
                }).catch(err => {
                    stage.classList.remove('active');
                    alert("ì¸ì¦ì„œ ìƒì„± ì‹¤íŒ¨: " + err);
                });
            }, 800);
        };

        window.closePreview = function() { document.getElementById('img-preview-modal').classList.remove('show'); }

        window.fireConfetti = function() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = document.getElementById('mobile-frame').offsetWidth;
            canvas.height = document.getElementById('mobile-frame').offsetHeight;
            const particles = [];
            const colors = ['#A855F7', '#EC4899', '#3B82F6', '#F59E0B', '#10B981'];
            for(let i=0; i<150; i++) particles.push({ x: canvas.width/2, y: canvas.height*0.25, vx:(Math.random()-0.5)*20, vy:(Math.random()-0.5)*20-5, color:colors[Math.floor(Math.random()*colors.length)], size:Math.random()*6+2, life:150, gravity:0.5 });
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) { active = true; p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity; p.life--; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); }
                });
                if(active) requestAnimationFrame(animate); else ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            animate();
        };

        window.onload = function() { window.renderResultList(); window.switchTab(0); };
        window.switchTab = function(index) {
            if(index === 1) { alert('ë‚´ ì •ë³´ ê¸°ëŠ¥ì€ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.'); return; }
            document.getElementById('nav-bg').style.transform = `translateX(${index * 60}px)`;
        };

        window.renderResultList = function() {
            const list = document.getElementById('result-list'); list.innerHTML = '';
            window.polls.filter(p => p.type === 'result').forEach(p => {
                list.innerHTML += `<div class="toss-card p-5 flex items-center justify-between active:scale-[0.98] transition-transform" onclick="window.openPollDetail(${p.id})"><div class="flex items-center gap-4 flex-1 overflow-hidden"><div class="w-12 h-12 rounded-[20px] ${p.color} flex items-center justify-center text-xl shadow-sm shrink-0">${p.icon}</div><div class="overflow-hidden"><h4 class="text-base font-bold text-[#191F28] leading-tight mb-0.5 truncate pr-2">${p.title}</h4><p class="text-xs text-gray-500 font-medium">${p.total}ëª… ì°¸ì—¬ Â· ì¢…ë£Œë¨</p></div></div><div class="flex items-center gap-1.5 shrink-0 pl-2"><span class="text-xs font-medium text-gray-400">ê²°ê³¼ë³´ê¸°</span><i class="fa-solid fa-chevron-right text-gray-300 text-xs"></i></div></div>`;
            });
        };

        window.openPollDetail = function(id) {
            window.currentPollId = id; window.selectedOptionIdx = null;
            const p = window.polls.find(item => item.id === id);
            document.getElementById('detail-title').innerText = p.title;
            document.getElementById('detail-info').innerText = `ì‘ì„±ì: ${p.author} Â· ${p.total}ëª… ì°¸ì—¬`;
            const badge = document.getElementById('poll-badge');
            if(p.type === 'active') { badge.className = "inline-block px-2 py-1 bg-purple-100 text-purple-600 text-[10px] font-bold rounded mb-2"; badge.innerText = "ì§„í–‰ì¤‘"; } 
            else { badge.className = "inline-block px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-bold rounded mb-2"; badge.innerText = "ì¢…ë£Œë¨"; }
            window.renderDetailContent(p);
            document.getElementById('modal-detail').classList.add('open');
            if(p.hasVoted) setTimeout(window.fireConfetti, 300);
        };
        window.closeModal = function() { document.getElementById('modal-detail').classList.remove('open'); };

        window.renderDetailContent = function(p) {
            const container = document.getElementById('detail-options');
            const btnSubmit = document.getElementById('btn-submit');
            const resultButtons = document.getElementById('result-buttons');
            container.innerHTML = '';
            const showResult = p.type === 'result' || p.hasVoted;

            if(!showResult) {
                btnSubmit.classList.remove('hidden'); resultButtons.classList.add('hidden'); btnSubmit.disabled = true; btnSubmit.innerText = "íˆ¬í‘œí•˜ê¸°";
                p.options.forEach((opt, idx) => {
                    container.innerHTML += `<label class="block cursor-pointer group active:scale-[0.98] transition-all"><input type="radio" name="v_opt" class="hidden peer" onchange="window.selectOption(${idx})"><div class="p-4 rounded-[20px] bg-white border border-white/60 shadow-sm flex items-center justify-between peer-checked:border-purple-500 peer-checked:ring-1 peer-checked:ring-purple-500 peer-checked:bg-purple-50 transition-all"><span class="font-bold text-[#191F28]">${opt.text}</span><div class="w-5 h-5 rounded-full border-2 border-gray-200 peer-checked:border-purple-500 peer-checked:bg-purple-500 flex items-center justify-center"><i class="fa-solid fa-check text-white text-[10px]"></i></div></div></label>`;
                });
            } else {
                btnSubmit.classList.add('hidden');
                if(p.type === 'active') resultButtons.classList.remove('hidden'); else resultButtons.classList.add('hidden');
                const max = Math.max(...p.options.map(o => o.count));
                p.options.forEach((opt, idx) => {
                    const pct = p.total === 0 ? 0 : Math.round((opt.count / p.total) * 100);
                    const isWin = opt.count === max && max > 0;
                    const isMy = idx === p.myPick;
                    const wrapperClass = isWin ? "rank-1-card p-5 rounded-[24px] mb-4 relative overflow-hidden" : "bg-white p-4 rounded-[20px] mb-3 border border-gray-100 shadow-sm relative overflow-hidden";
                    const barClass = isWin ? "bar-gradient" : "bg-gray-300";
                    const medal = isWin ? `<span class="ml-2 text-5xl inline-block align-middle drop-shadow-md">ğŸ¥‡</span>` : '';
                    container.innerHTML += `<div class="${wrapperClass}"><div class="flex justify-between items-end mb-2 relative z-10"><div><h4 class="text-base font-bold text-[#191F28] flex items-center">${opt.text} ${medal} ${isMy ? '<span class="text-[10px] bg-purple-100 text-purple-600 px-1.5 py-0.5 rounded font-bold ml-2 self-center">MY</span>' : ''}</h4><p class="text-xs text-gray-400 font-medium mt-0.5">${opt.count}í‘œ</p></div><div class="text-right"><span class="text-2xl font-bold text-purple-600 number-counting" data-target="${pct}">0</span><span class="text-sm font-bold text-purple-400">%</span></div></div><div class="w-full bg-gray-100 rounded-full overflow-hidden relative z-10 ${isWin?'h-3':'h-2'}"><div class="${barClass}" style="width: 0%; height: 100%; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); border-radius: 99px;" data-width="${pct}%"></div></div></div>`;
                });
                setTimeout(() => {
                    container.querySelectorAll('[data-width]').forEach(el => el.style.width = el.getAttribute('data-width'));
                    container.querySelectorAll('.number-counting').forEach(el => {
                        const target = +el.getAttribute('data-target'); let current = 0;
                        const update = () => { current += Math.ceil((target - current) * 0.1); el.innerText = current; if(current < target) requestAnimationFrame(update); };
                        update();
                    });
                }, 100);
            }
        };

        window.selectOption = function(idx) { window.selectedOptionIdx = idx; document.getElementById('btn-submit').disabled = false; };
        window.submitVote = function() {
            if(window.selectedOptionIdx === null) return;
            const p = window.polls.find(item => item.id === window.currentPollId);
            p.options[window.selectedOptionIdx].count++; p.total++; p.myPick = window.selectedOptionIdx; p.hasVoted = true;
            window.renderDetailContent(p); window.fireConfetti();
        };
        window.voteAgain = function() {
            const p = window.polls.find(item => item.id === window.currentPollId);
            p.hasVoted = false; p.myPick = null; window.selectedOptionIdx = null; window.renderDetailContent(p);
        };
    </script>
</body>
</html>


